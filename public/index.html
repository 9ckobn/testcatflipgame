<!DOCTYPE html>
<html lang="en-us">
<head>
  <meta charset="utf-8">
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8">
  <title>Unity WebGL Player | Catflip Run</title>
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <style>
    body, html {
      margin: 0;
      padding: 0;
      overflow: hidden;
      height: 100%;
      width: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #loading-screen {
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
      background: url('/1.png') no-repeat center center fixed;
      background-size: contain;
      z-index: 1000;
      transition: opacity 1s ease;
      display: flex;
      align-items: center;
      justify-content: center;
    }

    #loading-icon {
      width: 100px;
      height: 100px;
      background: url('/2.png') no-repeat center center;
      background-size: contain;
      animation: spin 2s linear infinite;
    }

    @keyframes spin {
      0% { transform: rotate(0deg); }
      100% { transform: rotate(360deg); }
    }

    canvas {
      display: none;
      position: absolute;
      top: 0;
      left: 0;
      width: 100%;
      height: 100%;
    }
  </style>
</head>
<body>

<div id="loading-screen">
  <div id="loading-icon"></div>
</div>

<canvas id="unity-canvas" width=645 height=1398></canvas>

<script src="Build/36c69a970bbbf468f4a412b485f7c710.loader.js"></script>
<script>
  Telegram.WebApp.expand();

  if (/iPhone|iPad|iPod|Android/i.test(navigator.userAgent)) {
    var meta = document.createElement('meta');
    meta.name = 'viewport';
    meta.content = 'width=device-width, height=device-height, initial-scale=1.0, user-scalable=no, shrink-to-fit=yes';
    document.getElementsByTagName('head')[0].appendChild(meta);

    var canvas = document.querySelector("#unity-canvas");
    canvas.style.width = "100%";
    canvas.style.height = "100%";
    canvas.style.position = "fixed";

    document.body.style.textAlign = "left";
  }

  createUnityInstance(document.querySelector("#unity-canvas"), {
    dataUrl: "Build/1aca80a758fe79966c09c82d71edc7d1.data.br",
    frameworkUrl: "Build/61a45b0a4b81fa32c18230e2fbfc4d67.framework.js.br",
    codeUrl: "Build/bd61cf2a732b95e6d68dd114aef59877.wasm.br",
    streamingAssetsUrl: "StreamingAssets",
    companyName: "Catflip IO",
    productName: "Catflip Run",
    productVersion: "0.1",
    onProgress: function(unityInstance, progress) {
      // Обновление прогресса не требуется, т.к. используется вращающаяся иконка
    }
  }).then((unityInstance) => {
    const initData = Telegram.WebApp.initDataUnsafe;
    const userData = {
      user: initData.user,
      referral: initData.start_param
    };
    unityInstance.SendMessage('Boot', 'SetUserRaw', JSON.stringify(userData));

    setTimeout(() => {
      document.querySelector('canvas').style.display = 'block';
      document.getElementById('loading-screen').style.display = 'none';
    }, 3000);

  }).catch((message) => {
    alert(message);
  });

  function ShareInviteLink(url) {
    window.location.href = url;
  }

  function OpenUrl(url) {
    Telegram.WebApp.openLink(url);
  }
</script>
</body>
</html>
